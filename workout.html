<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>Add Mission</title>
		<style>
			.content_contain {
				height: 90%;
				width: 90%;
				/* SET MIN WIDTH AND HEIGHT REQUIREMENTS */
				margin: 0 auto;
				border: 4px solid black;
				border-radius: 6px;
			}
		</style>
		<script>
			var isDist = /(\d*)k/i;
			var isSmallDist = /(\d*)m/i;
			var isTime = /(\d*)min\w?/i;
			
			var parseOut = function() {
				rawString = document.getElementById("name_string").value;
				output = rawString.toString().toLowerCase();
				console.log(output);
				output = output.replace(/ /g, '');
				console.log(output);
				output = output.split("x");
				console.log(output);
				for(i = 0; i < output.length; i++) {
					if (output[i].split("@").length > 1){
						temp = output[i].split("@");
						output[i] = temp[0];
						output.splice(i+1, 0, temp[1])
					}
				}
				console.log(output);
				outJson = {"sets": 0, "reps": 0, "distance": 0, "time": 0, "strokes": "vars", "dist_type": 1};
				if (output.length == 4) {
					//Assuming that first is sets, 2nd is reps, 3rd is req, 4th is spm
					outJson["sets"] = output[0];
					outJson["reps"] = output[1];
					outJson["strokes"] = output[3];
					outJson = getPiece(output[2], outJson);
				} else {
					outJson["sets"] = 1;
					if (output.length == 3) {
						//Two options (reps, req, spm) and (sets, reps, req)
						if (!(isDist.test(output[2]) || isSmallDist.test(output[2]) || isTime.test(output[2]))) {
							outJson["sets"] = 1;
							outJson["reps"] = output[0];
							outJson["strokes"] = output[2]
							outJson = getPiece(output[1], outJson);
						} else {
							outJson["sets"] = output[0];
							outJson["reps"] = output[1];
							outJson = getPiece(output[2], outJson);
						}
					} else {
						if (output.length == 2) {
							//Two options (reps, req) and (req, spm)
							outJson["sets"] = 1;
							if (!(isDist.test(output[1]) || isSmallDist.test(output[1]) || isTime.test(output[1]))) {
								outJson["reps"] = 1;
								outJson["strokes"] = output[1];
								outJson = getPiece(output[0], outJson);
							} else {
								outJson["sets"] = 1;
								outJson["reps"] = output[0];
								outJson = getPiece(output[1], getPiece);
							}
						} else {
							if (output.length == 1) {
								outJson["sets"] = 1;
								outJson["reps"] = 1;
								outJson = getPiece(output[0], outJson);
							} else {
							 console.log("cannot parse");
							}
						}
					}
				}
				console.log(outJson);
			}
			var getPiece = function(piece, outJson) {
				if (isDist.test(piece)){
					temp = piece.match(isDist);
					outJson["distance"] = temp[1];
				//THE isTime REGEX MUST BE TESTED FIRST
				} else if (isTime.test(piece)) {
					temp = piece.match(isTime);
					outJson["time"] = temp[1];
				} else if (isSmallDist.test(piece)) {
					temp = piece.match(isSmallDist);
					outJson["distance"] = temp[1];
					outJson["dist_type"] = 2;
				} else {
					return null;
				}
				return outJson;
			}
		</script>
	</head>
	<body>
		<div class=content_contain>
			<h3>Add a mission</h3>
			<input type= text placeholder="put mission here" size=30 id=name_string> </input>
			<button class=task_button onclick=parseOut()>Set Mission</button>
		</div>
		<br>
		<div class=content_contain>
			<h3>Please Verify Fields</h3>
			
		</div>
	</body>
</html>
